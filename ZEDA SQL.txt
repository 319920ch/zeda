CREATE TABLE IF NOT EXISTS ROLES (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NOMBRE TEXT NOT NULL,
    DESCRIPCION TEXT
);

CREATE TABLE IF NOT EXISTS USUARIOS (
    ID TEXT PRIMARY KEY ,
    NOMBRE TEXT NOT NULL,
    ROL_ID INTEGER,
    FECHA_INGRESO DATE NOT NULL,
    FECHA_SALIDA DATE,
    ESTADO TEXT NOT NULL,
    FOREIGN KEY (ROL_ID) REFERENCES ROLES(ID)
);

CREATE TABLE IF NOT EXISTS HISTORIAL_USUARIOS (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    USUARIO_ID TEXT NOT NULL,
    FECHA DATE NOT NULL,
    ACCION TEXT NOT NULL,
    OBSERVACION TEXT,
    FOREIGN KEY(USUARIO_ID) REFERENCES USUARIOS(ID)
);

CREATE TABLE IF NOT EXISTS PROVEEDOR (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NOMBRE TEXT NOT NULL,
    DIRECCION TEXT,
    CONTACTO TEXT NOT NULL,
    FECHA_REGISTRO DATE NOT NULL,
    ESTADO TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS MATERIA (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NOMBRE TEXT NOT NULL,
    DESCRIPCION TEXT,
    PROVEEDOR_ID INTEGER NOT NULL,
    PRECIO_COMPRA REAL NOT NULL,
    MEDIDA TEXT NOT NULL,
    CANTIDAD REAL NOT NULL,
    FECHA_REGISTRO DATE NOT NULL,
    ESTADO TEXT NOT NULL,
    FOREIGN KEY (PROVEEDOR_ID) REFERENCES PROVEEDOR(ID)
);

CREATE TABLE IF NOT EXISTS HISTORIAL_MATERIA (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    MATERIA_ID INTEGER NOT NULL,
    FECHA DATE NOT NULL,
    ACCION TEXT NOT NULL,
    OBSERVACION TEXT,
    FOREIGN KEY(MATERIA_ID) REFERENCES MATERIA(ID)
);

CREATE TABLE IF NOT EXISTS PRODUCTO (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NOMBRE TEXT NOT NULL,
    DESCRIPCION TEXT,
    COSTO_ELABORA REAL NOT NULL,
    PRECIO_VENTA REAL NOT NULL,
    GANANCIA REAL NOT NULL,
    MEDIDA TEXT NOT NULL,
    CANTIDAD REAL NOT NULL,
    FECHA_REGISTRO DATE NOT NULL,
    ESTADO TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS HISTORIAL_PRODUCTO (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    PRODUCTO_ID INTEGER NOT NULL,
    FECHA DATE NOT NULL,
    ACCION TEXT NOT NULL,
    OBSERVACION TEXT,
    FOREIGN KEY(PRODUCTO_ID) REFERENCES PRODUCTO(ID)
);

CREATE TABLE IF NOT EXISTS MATERIA_PRODUCTO (
    MATERIA_ID INTEGER NOT NULL,
    PRODUCTO_ID INTEGER NOT NULL,
    MEDIDA TEXT NOT NULL,
    CANTIDAD REAL NOT NULL,
    OBSERVACION TEXT,
    FECHA_INGRESO DATE NOT NULL,
    ESTADO TEXT NOT NULL,
    PRIMARY KEY (MATERIA_ID, PRODUCTO_ID),
    FOREIGN KEY (MATERIA_ID) REFERENCES MATERIA(ID),
    FOREIGN KEY (PRODUCTO_ID) REFERENCES PRODUCTO(ID)
);

CREATE TABLE IF NOT EXISTS HISTORIAL_MAT_PROD (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    PRODUCTO_ID INTEGER NOT NULL,
    MATERIA_ID INTEGER NOT NULL,
    FECHA DATE NOT NULL,
    FECHA_FIN DATE,
    ACCION TEXT NOT NULL,
    OBSERVACION TEXT,
    FOREIGN KEY(PRODUCTO_ID) REFERENCES PRODUCTO(ID),
    FOREIGN KEY(MATERIA_ID) REFERENCES MATERIA(ID)
);

CREATE TABLE IF NOT EXISTS KARDEX (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    TIPO TEXT NOT NULL,
    REFERENCIA_ID INTEGER NOT NULL,
    MOVIMIENTO TEXT NOT NULL,
    CANTIDAD REAL NOT NULL,
    MEDIDA TEXT NOT NULL,
    DESCRIPCION TEXT,
    FECHA DATE NOT NULL,
    USUARIO_ID TEXT NOT NULL,
    LOTE TEXT,
    OBSERVACION TEXT,
    FOREIGN KEY(USUARIO_ID) REFERENCES USUARIOS(ID)
);

CREATE TABLE IF NOT EXISTS MEDIDAS (
    MEDIDA TEXT PRIMARY KEY,
    NOMBRE TEXT NOT NULL,
    ENVASE TEXT NOT NULL,
    ESTADO TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS COSTOS_PROD (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NOMBRE TEXT NOT NULL,
    DESCRIPCION TEXT NOT NULL,
    PRODUCTO_MATERIA TEXT,
    COSTO REAL NOT NULL
);

CREATE TABLE IF NOT EXISTS REG_COSTOS (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    COSTOS_ID INTEGER NOT NULL,
    FECHA DATE NOT NULL,
    ACCION TEXT NOT NULL,
    OBSERVACION TEXT,
    FOREIGN KEY(COSTOS_ID) REFERENCES COSTOS_PROD(ID)
);
